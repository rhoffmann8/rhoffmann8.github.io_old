<p>One second, <a href="http://espn.go.com/blog/new-york/mets/post/_/id/110476/mets-sweep-nationals-in-catbird-seat-in-nl-east-race">I need to compose myself.</a></p>
<p>There are plenty of warnings out there that reliance on undocumented behavior is dangerous and could potentially break your app. Of course, there are many more developers out there that will still manage to sneak in a hack every now and then that will take advantage of some quirk which may or may not come back to haunt them later. The latest one of these I found had to do with jQuery&#39;s <a href="http://api.jquery.com/text/">.text()</a> function and its behavior across versions.</p>
<p>While refactoring a portion of our site we upgraded from jQuery 1.6.4 to 1.11.0. During QA it came to my attention that there was some random spacing appearing between the some validation error messages that did not happen prior to the upgrade.</p>
<div class="row center">
<div class="img-holder">
  <div class="img-holder-inner">
    <img src="/images/2015-09-10-error-messages.png">
    <img src="/images/2015-09-10-error-messages-spaced.png">
  </div>
  <p class="caption" style="max-width:400px;">
    Second image has slight vertical spacing between &quot;Date of Birth&quot; and &quot;Email&quot;. Apparently this was a big deal for the testing team.
  </p>
</div>
</div>

<p><em>Great, one of these.</em> I opened up my dev tools to see what was going on.</p>
<div class="row center">
<div class="img-holder">
  <div class="img-holder-inner">
    <img style="width:280px;" src="/images/2015-09-10-blank-error-div.png">
  </div>
  <p class="caption">
    Well that doesn&#39;t look right...
  </p>
</div>
</div>

<p>Without changing any script related to error message construction, a blank error div appeared out of the nether that wasn&#39;t there before. I dug deeper into the third-party script we fetched server-side that dealt with these messages and found the relevant code:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword" >for</span> <span class="token punctuation" >(</span><span class="token keyword" >var</span> field <span class="token keyword" >in</span> cfg<span class="token punctuation" >.</span>errorFields<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token punctuation" >(</span>field <span class="token operator" >===</span> <span class="token string" >"month"</span> <span class="token operator" >||</span> field <span class="token operator" >===</span> <span class="token string" >"day"</span> <span class="token operator" >||</span> field <span class="token operator" >===</span> <span class="token string" >"year"</span><span class="token punctuation" >)</span> <span class="token operator" >&amp;&amp;</span> <span class="token operator" >!</span>dobAdded<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    innerShell<span class="token punctuation" >.</span><span class="token function" >append</span><span class="token punctuation" >(</span><span class="token function" >$</span><span class="token punctuation" >(</span><span class="token string" >"&lt;div class=\"error\">"</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span>self<span class="token punctuation" >.</span>_blankMessages<span class="token punctuation" >[</span><span class="token string" >"dateOfBirth"</span><span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    dobAdded <span class="token operator" >=</span> <span class="token boolean" >true</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
    innerShell<span class="token punctuation" >.</span><span class="token function" >append</span><span class="token punctuation" >(</span><span class="token function" >$</span><span class="token punctuation" >(</span><span class="token string" >"&lt;div class=\"error\">"</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span>self<span class="token punctuation" >.</span>_blankMessages<span class="token punctuation" >[</span>field<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span></code></pre><p>So if any one of the &quot;month&quot;, &quot;day&quot;, or &quot;year&quot; fields were blank, the code would show the message for DOB. On a subsequent iteration, if it caught another one of these 3 fields which was also blank, it defaulted to appending a blank error div and assigning a default message for that particular field. Except &quot;month&quot;, &quot;day&quot;, and &quot;year&quot; were not indices of self._blankMessages, so the argument defaulted to <code>undefined</code>. On the old page, the result was no div being constructed. Why did it start appearing after the upgrade?</p>
<p>My suspicions were confirmed after running the same code on a test page with two different jQ libraries:</p>
<pre class="language-js"><code class="language-js"><span class="token operator" >></span> jQuery<span class="token punctuation" >.</span>fn<span class="token punctuation" >.</span>jquery
<span class="token string" >"1.6.4"</span>
<span class="token operator" >></span> <span class="token function" >$</span><span class="token punctuation" >(</span><span class="token string" >'&lt;div class="error">'</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span>undefined<span class="token punctuation" >)</span>
<span class="token string" >""</span></code></pre><pre class="language-js"><code class="language-js"><span class="token operator" >></span> jQuery<span class="token punctuation" >.</span>fn<span class="token punctuation" >.</span>jquery
<span class="token string" >"1.11.0"</span>
<span class="token operator" >></span> <span class="token function" >$</span><span class="token punctuation" >(</span><span class="token string" >'&lt;div class="error">'</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span>undefined<span class="token punctuation" >)</span>
<span class="token punctuation" >[</span> <span class="token operator" >&lt;</span>div <span class="token keyword" >class</span><span class="token operator" >=</span><span class="token string" >"error"</span><span class="token operator" >></span><span class="token operator" >&lt;</span><span class="token operator" >/</span>div<span class="token operator" >></span> <span class="token punctuation" >]</span></code></pre><p>Yep, there it is. Let&#39;s take a closer look at what&#39;s going on in jQuery:</p>
<pre class="language-js"><code class="language-js"><span class="token comment" spellcheck="true">// jQuery 1.6.4</span>
jQuery<span class="token punctuation" >.</span>fn<span class="token punctuation" >.</span><span class="token function" >extend</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
  text<span class="token punctuation" >:</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> text <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >if</span> <span class="token punctuation" >(</span> jQuery<span class="token punctuation" >.</span><span class="token function" >isFunction</span><span class="token punctuation" >(</span>text<span class="token punctuation" >)</span> <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >return</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >each</span><span class="token punctuation" >(</span><span class="token keyword" >function</span><span class="token punctuation" >(</span>i<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >var</span> self <span class="token operator" >=</span> <span class="token function" >jQuery</span><span class="token punctuation" >(</span> <span class="token keyword" >this</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>

        self<span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span> text<span class="token punctuation" >.</span><span class="token function" >call</span><span class="token punctuation" >(</span><span class="token keyword" >this</span><span class="token punctuation" >,</span> i<span class="token punctuation" >,</span> self<span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

    <span class="token keyword" >if</span> <span class="token punctuation" >(</span> <span class="token keyword" >typeof</span> text <span class="token operator" >!==</span> <span class="token string" >"object"</span> <span class="token operator" >&amp;&amp;</span> text <span class="token operator" >!==</span> undefined <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >return</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >empty</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >append</span><span class="token punctuation" >(</span> <span class="token punctuation" >(</span><span class="token keyword" >this</span><span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span> <span class="token operator" >&amp;&amp;</span> <span class="token keyword" >this</span><span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span><span class="token punctuation" >.</span>ownerDocument <span class="token operator" >||</span> document<span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >createTextNode</span><span class="token punctuation" >(</span> text <span class="token punctuation" >)</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

    <span class="token keyword" >return</span> jQuery<span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span> <span class="token keyword" >this</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span> <span class="token comment" spellcheck="true">// In our case "text" is undefined, so getter function</span>
                                <span class="token comment" spellcheck="true">// is triggered which will return a blank string</span>
  <span class="token punctuation" >}</span>

  <span class="token comment" spellcheck="true">//...</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment" spellcheck="true">// jQuery 1.11.0</span>
jQuery<span class="token punctuation" >.</span>fn<span class="token punctuation" >.</span><span class="token function" >extend</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
  text<span class="token punctuation" >:</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> value <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token function" >access</span><span class="token punctuation" >(</span> <span class="token keyword" >this</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> value <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >return</span> value <span class="token operator" >===</span> undefined <span class="token operator" >?</span>
        jQuery<span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span> <span class="token keyword" >this</span> <span class="token punctuation" >)</span> <span class="token punctuation" >:</span>
        <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >empty</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >append</span><span class="token punctuation" >(</span> <span class="token punctuation" >(</span> <span class="token keyword" >this</span><span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span> <span class="token operator" >&amp;&amp;</span> <span class="token keyword" >this</span><span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span><span class="token punctuation" >.</span>ownerDocument <span class="token operator" >||</span> document <span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >createTextNode</span><span class="token punctuation" >(</span> value <span class="token punctuation" >)</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span> <span class="token keyword" >null</span><span class="token punctuation" >,</span> value<span class="token punctuation" >,</span> arguments<span class="token punctuation" >.</span>length <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token comment" spellcheck="true">//...</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span></code></pre><p>Both versions check if the value is defined in order to determine if it should invoke getter or setter behavior. However 1.11.0 makes use of a separate function called <code>access</code> to do this. This function appeared sometime between 1.6.4 and 1.7.2.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword" >var</span> access <span class="token operator" >=</span> jQuery<span class="token punctuation" >.</span>access <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> elems<span class="token punctuation" >,</span> fn<span class="token punctuation" >,</span> key<span class="token punctuation" >,</span> value<span class="token punctuation" >,</span> chainable<span class="token punctuation" >,</span> emptyGet<span class="token punctuation" >,</span> raw <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >var</span> i <span class="token operator" >=</span> <span class="token number" >0</span><span class="token punctuation" >,</span>
    length <span class="token operator" >=</span> elems<span class="token punctuation" >.</span>length<span class="token punctuation" >,</span>
    bulk <span class="token operator" >=</span> key <span class="token operator" >==</span> <span class="token keyword" >null</span><span class="token punctuation" >;</span>

  <span class="token comment" spellcheck="true">// Sets many values</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span> jQuery<span class="token punctuation" >.</span><span class="token function" >type</span><span class="token punctuation" >(</span> key <span class="token punctuation" >)</span> <span class="token operator" >===</span> <span class="token string" >"object"</span> <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    chainable <span class="token operator" >=</span> <span class="token boolean" >true</span><span class="token punctuation" >;</span>
    <span class="token keyword" >for</span> <span class="token punctuation" >(</span> i <span class="token keyword" >in</span> key <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      jQuery<span class="token punctuation" >.</span><span class="token function" >access</span><span class="token punctuation" >(</span> elems<span class="token punctuation" >,</span> fn<span class="token punctuation" >,</span> i<span class="token punctuation" >,</span> key<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >,</span> <span class="token boolean" >true</span><span class="token punctuation" >,</span> emptyGet<span class="token punctuation" >,</span> raw <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

  <span class="token comment" spellcheck="true">// Sets one value</span>
  <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token keyword" >if</span> <span class="token punctuation" >(</span> value <span class="token operator" >!==</span> undefined <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    chainable <span class="token operator" >=</span> <span class="token boolean" >true</span><span class="token punctuation" >;</span>

    <span class="token keyword" >if</span> <span class="token punctuation" >(</span> <span class="token operator" >!</span>jQuery<span class="token punctuation" >.</span><span class="token function" >isFunction</span><span class="token punctuation" >(</span> value <span class="token punctuation" >)</span> <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      raw <span class="token operator" >=</span> <span class="token boolean" >true</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

    <span class="token keyword" >if</span> <span class="token punctuation" >(</span> bulk <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token comment" spellcheck="true">// Bulk operations run against the entire set</span>
      <span class="token keyword" >if</span> <span class="token punctuation" >(</span> raw <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        fn<span class="token punctuation" >.</span><span class="token function" >call</span><span class="token punctuation" >(</span> elems<span class="token punctuation" >,</span> value <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        fn <span class="token operator" >=</span> <span class="token keyword" >null</span><span class="token punctuation" >;</span>

      <span class="token comment" spellcheck="true">// ...except when executing function values</span>
      <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
        bulk <span class="token operator" >=</span> fn<span class="token punctuation" >;</span>
        fn <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> elem<span class="token punctuation" >,</span> key<span class="token punctuation" >,</span> value <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
          <span class="token keyword" >return</span> bulk<span class="token punctuation" >.</span><span class="token function" >call</span><span class="token punctuation" >(</span> <span class="token function" >jQuery</span><span class="token punctuation" >(</span> elem <span class="token punctuation" >)</span><span class="token punctuation" >,</span> value <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
      <span class="token punctuation" >}</span>
    <span class="token punctuation" >}</span>

    <span class="token keyword" >if</span> <span class="token punctuation" >(</span> fn <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      <span class="token keyword" >for</span> <span class="token punctuation" >(</span> <span class="token punctuation" >;</span> i <span class="token operator" >&lt;</span> length<span class="token punctuation" >;</span> i<span class="token operator" >++</span> <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token function" >fn</span><span class="token punctuation" >(</span> elems<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >,</span> key<span class="token punctuation" >,</span> raw <span class="token operator" >?</span> value <span class="token punctuation" >:</span> value<span class="token punctuation" >.</span><span class="token function" >call</span><span class="token punctuation" >(</span> elems<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >,</span> i<span class="token punctuation" >,</span> <span class="token function" >fn</span><span class="token punctuation" >(</span> elems<span class="token punctuation" >[</span>i<span class="token punctuation" >]</span><span class="token punctuation" >,</span> key <span class="token punctuation" >)</span> <span class="token punctuation" >)</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
      <span class="token punctuation" >}</span>
    <span class="token punctuation" >}</span>
  <span class="token punctuation" >}</span>

  <span class="token keyword" >return</span> chainable <span class="token operator" >?</span>
    elems <span class="token punctuation" >:</span>

    <span class="token comment" spellcheck="true">// Gets</span>
    bulk <span class="token operator" >?</span>
      fn<span class="token punctuation" >.</span><span class="token function" >call</span><span class="token punctuation" >(</span> elems <span class="token punctuation" >)</span> <span class="token punctuation" >:</span>
      length <span class="token operator" >?</span> <span class="token function" >fn</span><span class="token punctuation" >(</span> elems<span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span><span class="token punctuation" >,</span> key <span class="token punctuation" >)</span> <span class="token punctuation" >:</span> emptyGet<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span></code></pre><p>So what&#39;s changed? In 1.6.4 an <code>undefined</code> argument triggered the getter functionality of .text(), which was actually an <a href="https://github.com/jquery/jquery/pull/392">issue</a> of some debate years ago. With the addition of the access function however, a new condition <code>chainable</code> was introduced. In a typical getter invocation, .text() will call <code>access</code> as follows:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword" >return</span> <span class="token function" >access</span><span class="token punctuation" >(</span> <span class="token keyword" >this</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> value <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> value <span class="token operator" >===</span> undefined <span class="token operator" >?</span>
    jQuery<span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span> <span class="token keyword" >this</span> <span class="token punctuation" >)</span> <span class="token punctuation" >:</span>
    <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >empty</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >append</span><span class="token punctuation" >(</span> <span class="token punctuation" >(</span> <span class="token keyword" >this</span><span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span> <span class="token operator" >&amp;&amp;</span> <span class="token keyword" >this</span><span class="token punctuation" >[</span><span class="token number" >0</span><span class="token punctuation" >]</span><span class="token punctuation" >.</span>ownerDocument <span class="token operator" >||</span> document <span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >createTextNode</span><span class="token punctuation" >(</span> value <span class="token punctuation" >)</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >,</span> <span class="token keyword" >null</span><span class="token punctuation" >,</span> value<span class="token punctuation" >,</span> arguments<span class="token punctuation" >.</span>length <span class="token punctuation" >)</span><span class="token punctuation" >;</span> <span class="token operator" >&lt;</span>span <span class="token keyword" >class</span><span class="token operator" >=</span><span class="token string" >"bold"</span><span class="token operator" >></span><span class="token comment" spellcheck="true">// value = undefined, arguments.length = 0&lt;/span></span></code></pre><p>Since <code>arguments.length</code> is 0, <code>chainable</code> would evaluate to false and the callback provided from <code>text</code>, which switches on <code>return value === undefined</code> and runs <code>jQuery.text( this )</code>, would be invoked via <code>fn.call( elems )</code>.</p>
<p>According to the issue above, passing .text(undefined) should invoke the getter as well -- except we never get there. Since passing actual <code>undefined</code> results in <code>arguments.length</code> evaluating to 1, even though <code>value</code> is the same in both scenarios the callback function is never invoked! Instead, <code>elems</code> is returned rather than the blank string from the result of <code>jQuery.text</code>, so that was why the blank error div was being generated in the new site.</p>
<p>I&#39;m not sure if this modified behavior was an intended side effect of jQuery&#39;s access function, but there is a more important lesson here. The code should have been more explicit in handling this kind of scenario, especially since the fix is very simple:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword" >for</span> <span class="token punctuation" >(</span><span class="token keyword" >var</span> field <span class="token keyword" >in</span> cfg<span class="token punctuation" >.</span>errorFields<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>field <span class="token operator" >===</span> <span class="token string" >"month"</span> <span class="token operator" >||</span> field <span class="token operator" >===</span> <span class="token string" >"day"</span> <span class="token operator" >||</span> field <span class="token operator" >===</span> <span class="token string" >"year"</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span>dobAdded<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        innerShell<span class="token punctuation" >.</span><span class="token function" >append</span><span class="token punctuation" >(</span><span class="token function" >$</span><span class="token punctuation" >(</span><span class="token string" >"&lt;div class=\"error\">"</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span>self<span class="token punctuation" >.</span>_blankMessages<span class="token punctuation" >[</span><span class="token string" >"dateOfBirth"</span><span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        dobAdded <span class="token operator" >=</span> <span class="token boolean" >true</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
  <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
    innerShell<span class="token punctuation" >.</span><span class="token function" >append</span><span class="token punctuation" >(</span><span class="token function" >$</span><span class="token punctuation" >(</span><span class="token string" >"&lt;div class=\"error\">"</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >text</span><span class="token punctuation" >(</span>self<span class="token punctuation" >.</span>_blankMessages<span class="token punctuation" >[</span>field<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span></code></pre><p>Problem solved. Instead of defaulting to the else case when another DOB field is encountered, simply skip adding a DOB error div if we already did so. Relying on a side-effect of passing <code>undefined</code> is never a good idea, and it will eventually create a headache for your coworkers.</p>
<p>I understand this kind of stuff happens &mdash; after all, deadlines exist &mdash; but I hope this will remind you (it certainly did for me) to stop and think for a second next time you&#39;re in a situation like this and evaluate whether an odd behavior may be subject to change in the future.</p>
