<p>I&#39;m currently buried in over <a href="http://www.nbcnewyork.com/news/local/NYC-2016-Blizzard-Record-Snowfall-Historic-Snowstorm-Shuts-Down-Transit-Travel-Ban-Plows-366340361.html">20&quot; of snow</a>, so I might as well post something.</p>
<p>I wrote a piece of PHP code a while back to grab some data from a cache; if it couldn&#39;t find what it needed, it should try a couple of other scenarios before giving up. The code looked something like the following:</p>
<pre class="language-php"><code class="language-php"><span class="token variable" >$category</span> <span class="token operator" >=</span> <span class="token string" >'someCategory'</span><span class="token punctuation" >;</span>
<span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >setCategory</span><span class="token punctuation" >(</span><span class="token variable" >$category</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token variable" >$data</span> <span class="token operator" >=</span> <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >getData</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span><span class="token function" >count</span><span class="token punctuation" >(</span><span class="token variable" >$data</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >setCategory</span><span class="token punctuation" >(</span><span class="token variable" >$category</span> <span class="token operator" >+</span> <span class="token string" >'-someAlternative'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token variable" >$data</span> <span class="token operator" >=</span> <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >getData</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span><span class="token function" >count</span><span class="token punctuation" >(</span><span class="token variable" >$data</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >setCategory</span><span class="token punctuation" >(</span><span class="token variable" >$category</span> <span class="token operator" >+</span> <span class="token string" >'-someOtherAlternative'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token variable" >$data</span> <span class="token operator" >=</span> <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >getData</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span>

<span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span><span class="token function" >count</span><span class="token punctuation" >(</span><span class="token variable" >$data</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token variable" >$data</span> <span class="token operator" >=</span> <span class="token keyword" >null</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span></code></pre><p>Yuck. An obvious solution would have been to refactor this logic into a method and return the data if it&#39;s found, avoiding the extra checks. If this was JavaScript, a function expression would have done the job:</p>
<pre class="language-php"><code class="language-php"><span class="token keyword" >var</span> result <span class="token operator" >=</span> <span class="token punctuation" >(</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
  let category <span class="token operator" >=</span> <span class="token string" >'someCategory'</span><span class="token punctuation" >;</span>
  cacheHandler<span class="token punctuation" >.</span><span class="token function" >setCategory</span><span class="token punctuation" >(</span>category<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>data <span class="token operator" >=</span> cacheHandler<span class="token punctuation" >.</span><span class="token function" >getData</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token keyword" >return</span> data<span class="token punctuation" >;</span>

  category <span class="token operator" >=</span> <span class="token string" >'someCategory2'</span><span class="token punctuation" >;</span>
  cacheHandler<span class="token punctuation" >.</span><span class="token function" >setCategory</span><span class="token punctuation" >(</span>category<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>data <span class="token operator" >=</span> cacheHandler<span class="token punctuation" >.</span><span class="token function" >getData</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token keyword" >return</span> data<span class="token punctuation" >;</span>

  <span class="token comment" spellcheck="true">// etc...</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span></code></pre><p>But this was PHP. I&#39;m guessing at the time I didn&#39;t want to bother making a new method for a one-off operation, so I left it as is. I&#39;m guessing. There are many times I look at my old code and wonder what the hell I was thinking.</p>
<p>Months later, a veteran on my team refactored the file. When I checked the code again, I saw this block in its place:</p>
<pre class="language-php"><code class="language-php"><span class="token keyword" >do</span> <span class="token punctuation" >{</span>
  <span class="token variable" >$category</span> <span class="token operator" >=</span> <span class="token string" >'someCategory'</span><span class="token punctuation" >;</span>
  <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >setCategory</span><span class="token punctuation" >(</span><span class="token variable" >$category</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span><span class="token variable" >$data</span> <span class="token operator" >=</span> <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >getData</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token keyword" >break</span><span class="token punctuation" >;</span>

  <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >setCategory</span><span class="token punctuation" >(</span><span class="token variable" >$category</span> <span class="token operator" >+</span> <span class="token string" >'-someAlternative'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span><span class="token variable" >$data</span> <span class="token operator" >=</span> <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >getData</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token keyword" >break</span><span class="token punctuation" >;</span>

  <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >setCategory</span><span class="token punctuation" >(</span><span class="token variable" >$category</span> <span class="token operator" >+</span> <span class="token string" >'-someOtherAlternative'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span><span class="token operator" >!</span><span class="token variable" >$data</span> <span class="token operator" >=</span> <span class="token variable" >$cacheHandler</span><span class="token operator" >-</span><span class="token operator" >></span><span class="token function" >getData</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >)</span> <span class="token keyword" >break</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span> <span class="token keyword" >while</span> <span class="token punctuation" >(</span><span class="token number" >0</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span></code></pre><p>The <code>do-while</code> loop will only execute once and creates a separate block that can be broken out of at any time. It was a pretty neat trick I hadn&#39;t seen before, in case you don&#39;t want to extract the code to another method.</p>
